@model IEnumerable<contact.Models.CShoppingCartItem>

@{
    ViewBag.Title = "CartView";
}
@{
    Layout = "~/Views/Shared/_Layoutsale.cshtml";
}




@section scripts{
    <script>

        var num = 1;

         @foreach(var item in Model)
        {

            if (item.可訂購數量 != "足夠")
            {
                 @:num = 0;
                  break;
            }

         }



        function che(e) {
            if (num == 0) {

                alert("商品數量已超過可訂購數量");
                e.href = "/Shopping/CartView";
            } else {
                href
            }
            return true;
        }

        //購物車清空 慧芬
        const money = document.getElementById("money").textContent;

       document.addEventListener('DOMContentLoaded', function () {
           const empty = document.getElementById('empty');
           const goCheck = document.getElementById('goCheck');
           const list = document.querySelector('.noshow');
            if (money =="0"){
                empty.removeAttribute("hidden");
                goCheck.setAttribute("hidden", "true");
                list.setAttribute("hidden", "true");
           };
       })

       //資料庫的售價 單價 及小計去小數 慧芬
        var moneyPer = [];
        var moneyAdd = [];
          @foreach (var item in Model)
        {
            @:moneyPer.push("@Convert.ToDouble(@item.單價)");
            @:moneyAdd.push("@Convert.ToDouble(@item.小計)");
        }

        
        var newmoneyPer = document.querySelectorAll('td.moneyPer');
       

        for (let index in moneyPer)
        {

            newmoneyPer[index].innerHTML = moneyPer[index];

        }
        var newmoneyAdd = document.querySelectorAll('td.moneyAdd');
        for (let index in moneyAdd) {

            newmoneyAdd[index].innerHTML = moneyAdd[index];

        }


    </script>
}
<div class="container vh-100">

    <div class="row justify-content-center table-responsive-md">
        <table class="table table-striped mt-5 col-12 col-md-12">
            <tr class="table-dark">
                <th class="col-1" style="display:none" ></th>

                <th class="col-1">@Html.DisplayNameFor(model => model.品牌名稱)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.產品名稱)</th>

                <th class="col-1">@Html.DisplayNameFor(model => model.產品顏色)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.近視度數)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.散光度數)</th>

                <th class="col-1">@Html.DisplayNameFor(model => model.散光角度)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.數量)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.單價)</th>
                
                <th class="col-1">@Html.DisplayNameFor(model => model.小計)</th>
                
                <th class="col-1">可購買數量</th>
                
                <th class="col-1"></th>
            </tr>

            @using (Html.BeginForm())
            {

                decimal tempTotal = 0;
                int countDel = 0;
                foreach (var item in Model)
                {
                    tempTotal += item.小計;
                    countDel++;
                    <tr>
                        <td style="display:none" ><input type="hidden" name="txtFid" value="@Model.FirstOrDefault().Product.f產品ID" /></td>

                        <td>@Html.DisplayFor(modelItem => item.品牌名稱)</td>

                        <td>@Html.DisplayFor(modelItem => item.產品名稱)</td>

                        <td>@Html.DisplayFor(modelItem => item.產品顏色)</td>

                        <td>@Html.DisplayFor(modelItem => item.近視度數)</td>

                        <td>@Html.DisplayFor(modelItem => item.散光度數)</td>

                        <td>@Html.DisplayFor(modelItem => item.散光角度)</td>

                        <td>@Html.DisplayFor(modelItem => item.數量)</td>

                        <td class="moneyPer">@Html.DisplayFor(modelItem => item.單價)</td>

                        <td class="moneyAdd">@Html.DisplayFor(modelItem => item.小計)</td>

                        <td>@Html.DisplayFor(modelItem => item.可訂購數量)</td>

                        <td>
                            @Html.ActionLink("刪除", "Delete", new { id = countDel }, new { @class = "btn btn-outline-danger btn-sm" })
                        </td>
                    </tr>
                }
        <tr>
            <td style="display:none"></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>總價</td>
            <td><p id="money">@Convert.ToDouble(@tempTotal).ToString()</p></td>
            <td>元</td>
            <td></td>
        </tr>

            }


        </table>
    </div>

    <div class="row text-center" id="empty" hidden>
        <div class="col-12 col-md-12">
            <i class="fa fa-shopping-cart fa-5" style="font-size:15rem;"></i>
            <h5 class="mt-3">您的購物車是空的</h5>
            <p>記得加入商品到您的購物車</p>
            <a class="btn tomatobtn " href="/Shopping/List/">繼續購物</a>
        </div>
    </div>


    @*@using (Html.BeginForm())
        {
            <p>訂購資訊</p>
            <p>
                <input type="checkbox" id="sameWithAccount" value="與會員資料相同" onclick="autoFillIn()" />
                <label for="cbox1">與會員資料相同</label>
            </p>

            <div>
                <p>
                    訂購人：
                    <input type="text" name="f訂購人" class="" placeholder="請輸入訂購人姓名" id="f訂購人" />
                </p>
                <p>
                    連絡電話：
                    <input type="text" name="f連絡電話" class="" placeholder="請輸入連絡電話" id="f連絡電話" />
                </p>
                <p>
                    寄送地址：
                    <input type="text" name="f寄送地址" class="" placeholder="請輸入寄送地址" id="f寄送地址" />
                </p>
                <p>
                    電子信箱：
                    <input type="text" name="f訂購人信箱" class="" placeholder="請輸入電子信箱" id="f訂購人信箱" />
                </p>

            </div>
            <div>
                <p>
                    訂單需求：
                    <select id="orderDemand" name="f訂單需求">
                        <option selected disabled>請選擇訂單需求</option>
                        <option>客需</option>
                        <option>庫存</option>
                        <option>其他</option>
                    </select>
                </p>
                <p>
                    訂單備註：
                    <textarea name="f訂單備註"></textarea>
                </p>
                <p>
                    訂單總金額：
                <p name="f訂單總金額"></p>
                </p>
                <p>
                    付款方式：
                    <select id="payment" name="f付款方式">
                        <option selected disabled>請選擇付款方式</option>
                        <option>銀行轉帳</option>
                        <option>線上刷卡</option>
                        <option>現金支付</option>
                    </select>
                </p>
            </div>

        }*@

    @*@Html.ActionLink("結帳", "../CCustomer/CheckOut", new { /* id=item.PrimaryKey */ })*@
    <div class="offset-md-10 col-md-2 col-12 mt-5 ">
        <a href="/CCustomer/CheckOut" class="btn tomatodangerbtn" onclick="che(this)" id="goCheck">前往結帳</a><a class="btn tomatobtn noshow" href="/Shopping/List">繼續購物</a>
    </div>
  


</div>
